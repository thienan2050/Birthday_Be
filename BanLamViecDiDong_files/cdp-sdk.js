const OnCDP_NOVAON=function(){function d(t){try{fetch(i,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({website_id:r(),client_id:u(),events:[{name:"add_to_cart",params:{...n(),currency:"",value:t.price/100,items:[{item_id:t.product_id,item_name:t.title,currency:"",item_brand:t.vendor,item_variant:t.variant_title,price:t.price/100,quantity:t.quantity}]}}]})})}catch(f){console.log("Err add_to_cart",f)}}function g(){try{function t(n){const t=n.replace(/[^\d.-]/g,"");return parseFloat(t)}function f(n){const t=n.match(/\d+/g);return t?t.join(""):""}Haravan.getCart(()=>{var o=[],e,h,c;HaravanAnalytics!==null&&(currency=HaravanAnalytics.meta.currency);e=document.querySelector(".os-order-number");let s="";e!=null&&(s=e.textContent);h=document.querySelectorAll(".product");c=Array.from(h).map(function(n){return n});c.forEach(function(n,i){var n={item_id:n.dataset.productId,item_name:n.children[1].outerText,index:i,item_variant:n.variant_title,price:t(n.children[3].outerText)/n.children[2].outerText,quantity:n.children[2].outerText};o.push(n)});fetch(i,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({website_id:r(),client_id:u(),events:[{name:"purchase",params:{...n(),transaction_id:f(s),items:o}}]})})});localStorage.setItem("IdCheckOut","")}catch(t){console.log("Err purchase",t)}}function s(){t("page_view",{...n()})}function nt(){t("form_submit",{...n()})}function tt(n){try{var t=new URL(document.location.href);return decodeURIComponent(t.searchParams.get(n))}catch(i){return""}}function it(n,t){var i=document.querySelector("meta["+n+'="'+t+'"]');return i?i.getAttribute("content"):null}function n(){return{sw:window.screen.width,sh:window.screen.height,dl:document.location.toString(),dr:document.referrer,dt:document.title,dp:document.location.pathname}}function r(){return typeof autoAdsMaxLead_widget_options!="undefined"&&autoAdsMaxLead_widget_options.business.business_id!==""?autoAdsMaxLead_widget_options.business.business_id:window.location.hostname}function u(){return typeof autoAdsMaxLead_widget_options!="undefined"?autoAdsMaxLead_widget_options.identity:""}function t(n,t){try{fetch(i,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({website_id:r(),client_id:u(),events:[{name:n,params:t}]})})}catch(f){console.log("Err"+n,f)}}function rt(){var l=document.querySelector(".product_title"),t=document.querySelector(".price .amount"),a=document.querySelector(".sku_wrapper .sku"),v=document.querySelector(".price .woocommerce-Price-currencySymbol"),u,f,n,i,r,y,e,o,s,h,c;if(t){u="";t=t.textContent.trim();for(let n=0;n<t.length;n++)isNaN(t.charAt(n))||(u+=t.charAt(n))}for(f=document.querySelectorAll("form"),n=0,i=0;i<f.length;i++)r=f[i],y=r.getAttribute("method"),y==="post"&&(e=r.getAttribute("data-product_id"),e&&(n=e)),n==0&&(o=r.querySelector("button[type=submit]"),o&&(s=parseInt(o.value),s>0&&(n=s))),n==0&&(h=document.querySelector("input[type=hidden][id*='product']"),h&&(c=parseInt(h.value),c>0&&(n=c)));return{id:n,productSku:a?a.textContent.trim():"",productTitle:l?l.textContent.trim():"",productPrice:u,currencySymbol:v?v.textContent.trim():""}}function ut(){var i=rt(),r={...n(),custom_id:i.id,custom_name:i.productTitle,currency:i.currencySymbol,value:i.productPrice,items:[{item_id:i.id,item_name:i.productTitle,currency:i.currencySymbol,item_brand:"",item_category:"",price:i.productPrice}]};t("view_item",r)}function h(){var rt,ii,ft,l,ri,ui,lt,at,ot,vt,ci,pt,wt,ht,p,d,gi,bt,li,kt,dt,y,ai,gt,ni,u,vi,c,i,r,yi,pi;if(!o&&(typeof autoAdsMaxLead_widget_options=="undefined"||autoAdsMaxLead_widget_options.business.business_id==="")){setTimeout(h,1e3);return}if(s(),k){if(f){var ti=0,a="",nt="VND",b=document.location.pathname.split("/");if(HaravanAnalytics)try{a=HaravanAnalytics.meta.page.pageType;ti=HaravanAnalytics.meta.page.resourceId;nt=HaravanAnalytics.meta.currency}catch(nr){}else{a=b[1];switch(a){case"collections":a="collection";break;case"products":a="product";break;case"search":a="searchresults"}}switch(a){case"collection":i="view_item_list";r={...n(),custom_id:ti,custom_name:b[2],items:[]};t(i,r);break;case"product":Haravan.getProduct(b[2],i=>{var r={...n(),custom_id:i.id,custom_name:i.title,currency:nt,value:i.price/100,items:[{item_id:i.id,item_name:i.title,currency:nt,item_brand:i.vendor,item_category:i.type,price:i.price/100}]},u=sessionStorage.getItem("OnCDP_LastViewProduct")??r.dr;!r.dr.includes("/products")&&u.includes("/products")&&(r.dr=u);t("view_item",r);u=r.dl;sessionStorage.setItem("OnCDP_LastViewProduct",u)});break;case"cart":rt=[];Haravan.getCart(i=>{i.items.forEach(function(n,t){var n={item_id:n.id,item_name:n.title,index:t,item_brand:n.vendor,item_variant:n.variant_title,price:n.price/100,quantity:n.quantity};rt.push(n)});var r={...n(),currency:nt,value:i.total_price/100,items:rt};t("view_cart",r)});break;case"searchresults":if(ii=document.location.href,!ii.includes("search"))return;if(ft=tt("q"),l=ft,ft.indexOf("filter=(")===0)try{l=ft.split(":")[1];l=l.substring(0,l.indexOf(")"));l=l.replace("product**","").replace("product contains ","")}catch(nr){}i="view_search_results";r={...n(),search_term:l};t(i,r);break;case"checkouts":if(ri=localStorage.getItem("IdCheckOut"),ri==document.location.pathname)return"Checked";localStorage.setItem("IdCheckOut",document.location.pathname);Haravan.getCart(i=>{var r=[],u,f;i.items.forEach(function(n,t){var n={item_id:n.id,item_name:n.title,index:t,item_brand:n.vendor,item_variant:n.variant_title,price:n.price/100,quantity:n.quantity};r.push(n)});u="begin_checkout";f={...n(),items:r};t(u,f)})}b.length==4&&b[3]=="thank_you"&&g()}else if(e){var tr=it("property","og:type"),wi=document.location,et=wi.pathname.split("/");if(et.length>=3&&(et[1]=="danh-muc"||et[1]=="product-category")&&(i="view_item_list",r={...n(),custom_id:0,custom_name:et[2],items:[]},t(i,r)),ui=document.querySelectorAll(".woocommerce-order-details__title"),ui.length>0){var d=Number(document.querySelector(".woocommerce-order-overview__order strong").textContent),fi=document.querySelectorAll(".woocommerce-table__line-item"),ei=[];for(u=0;u<fi.length;u++)if(c={price:0,name:"",quantity:0},y=fi[u],y){var oi=y.querySelector("td.woocommerce-table__product-name a").textContent,si=Number(y.querySelector("td.woocommerce-table__product-total span").textContent.replace(/\D/g,"")),ct=Number(y.querySelector("td.woocommerce-table__product-name strong").textContent.replace(/\D/g,""));oi&&(c.name=oi);ct&&(c.quantity=ct);si&&(c.price=si/ct);ei.push(c)}i="purchase";r={...n(),transaction_id:d,items:ei};t(i,r)}if(lt=document.querySelector('meta[property="og:url"]'),lt&&(at=lt.getAttribute("content"),at.includes("search"))){var bi=at.split("/"),hi=bi.filter(function(n){return n!==""}),i="view_search_results",r={...n(),search_term:hi[hi.length-1]};t(i,r)}for(ot=document.querySelector("form.cart"),ot&&ut(),vt=document.querySelectorAll("form"),u=0;u<vt.length;u++)if(p=vt[u],ci=p.getAttribute("method"),ci==="post"){if(p.classList.contains("woocommerce-checkout")){var yt=[],ki=document.querySelectorAll("tr.cart_item"),st="",c={productID:0,textContent:0,price:0,quanity:0},w=0;ki.forEach(function(n){var f=n.querySelector("td.product-name"),i=n.querySelector("td.product-name strong.product-quantity"),r=n.querySelector("td.product-total span.woocommerce-Price-amount"),u=n.querySelector("td.product-price span.woocommerce-Price-currencySymbol"),t;u&&(st=u.innerText);f;i!=null&&(c.quanity=Number(i.textContent.replace(/\D/g,"")));r&&(t=Number(r.textContent.replace(/\D/g,"")),c.price=t/c.quanity);c.price=t/c.quanity;w=w+c.quanity*c.price;yt.push(c)});i="begin_checkout";r={...n(),currency:st,value:w,items:rt};t(i,r)}if(p.classList.contains("woocommerce-cart-form")){var di=document.querySelectorAll(".woocommerce-cart-form__cart-item.cart_item"),yt=[],st="",w=0;di.forEach(function(n){var t={item_id:0,item_name:"",price:0,quantity:0},r=n.querySelector("td.product-remove a[data-product_id]"),u=n.querySelector("td.product-name a"),f=n.querySelector("td.product-price span.amount"),e=n.querySelector("td.product-price span.woocommerce-Price-currencySymbol"),i;st=e.innerText;i=n.querySelector("td.product-quantity div.quantity.buttons_added input[type='number']");t.item_id=r?r.getAttribute("data-product_id"):0;t.item_name=u?u.textContent:"";t.price=f?f.innerText.replace(/\D/g,""):0;t.quantity=i?i.value:0;w=w+t.quantity*t.price;yt.push(t)});i="view_cart";r={...n(),currency:st,value:w,items:yt};t(i,r)}}}else if(v){if(pt=document.location,wt=document.querySelector("h1.page-title span"),wt&&(i="view_item_list",r={...n(),custom_id:0,custom_name:wt.textContent,items:[]},t(i,r)),ht=document.querySelectorAll('form[id="product_addtocart_form"]'),ht)for(u=0;u<ht.length;u++)p=ht[u],d="",d=Number(p.querySelector('input[name="product"]').value),i="view_item",r={...n(),custom_id:d,custom_name:get_view_item.productTitle,currency:"",value:"",items:[{item_id:d,item_name:"",currency:"",item_brand:"",item_category:"",price:""}]},t(i,r),ot.addEventListener("submit",function(){var i=0;i==0&&(i=Number(ot.getAttribute("data-product_id")));var r={id:i},u={...n(),currency:"",value:0,items:[{item_id:r.id,item_name:"",currency:"",item_brand:"",item_variant:"",price:0,quantity:0}]};t("add_to_cart",u)});if(gi=pt.pathname("/"),pt.href.includes("?q=")&&(bt=document.querySelector("input#seach"),bt&&(i="view_search_results",r={...n(),search_term:bt.toString()},t(i,r))),li=document.querySelector('form[class="form form-cart"]'),li){for(kt=[],dt=document.querySelectorAll("tbody.cart.item"),u=0;u<dt.length;u++)y=dt[u],i=y.querySelector("strong.product-item-name a"),i&&(c={productID:0,textContent:0,price:0,quanity:0},c.name=i.textContent,kt.push(c));i="view_cart";r={...n(),currency:"",value:0,items:kt};t(i,r)}if(ai=document.querySelector("div.checkout-container"),ai){for(gt=[],ni=document.querySelectorAll("li.product-item"),u=0;u<ni.length;u++)vi=ni[u],i=vi.querySelector("div.product-item-name-block strong"),i&&(c={productID:0,textContent:0,price:0,quanity:0},c.name=i.textContent,gt.push(c));i="begin_checkout";r={...n(),currency:"",value:0,items:gt};t(i,r)}yi=document.querySelector("div.checkout-success");yi}pi=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(){this.addEventListener("load",function(){var t,n;try{t=this.responseURL.toLowerCase();this.readyState===4&&(f&&t.includes("/cart/add.js")&&(n=JSON.parse(this.response),OnCDP_NOVAON.add_to_cart(n)),(t.includes("/api/widget/addlead")||t.includes("/api/widget/event"))&&(n=JSON.parse(this.response),n.success&&n.hasContactInfo&&OnCDP_NOVAON.form_submit()))}catch(i){console.log("Error in xhr load: ",i.toString())}});pi.apply(this,arguments)}}}const f=typeof Haravan!="undefined",e=typeof wc_add_to_cart_params!="undefined"|document.getElementsByClassName("woocommerce").length>0,c=typeof Shopify!="undefined",l=typeof prestashop!="undefined",a=typeof Magento!="undefined",v=typeof Magento2!="undefined"|document.querySelectorAll('script[type="text/x-magento-init"]').length>0,y=typeof opencart!="undefined",p=typeof bc!="undefined",w=typeof nopCommerce!="undefined",b=typeof sapo!="undefined",k=f||e||c||l||a||y||p||w||b,o=window.location.hostname==="localhost",i=o?"https://localhost:7051/mp/collect":"https://tracking.onmarketer.net/mp/collect";try{h()}catch(ft){console.log("Err onPageLoad",ft)}return{view_page:s,add_to_cart:d,form_submit:nt}}();